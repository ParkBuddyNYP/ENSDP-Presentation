@{
    ViewData["Title"] = "Index";
}

<h2>Carpark Usages</h2>

<script src="/lib/jquery/dist/jquery.js"></script>
<script src="/lib/bootstrap/dist/js/bootstrap.js"></script>
<script src="/js/site.js?v=4q1jwFhaPaZgr8WAUSrux6hAuh0XDg9kPS3xIVq36I0"></script>


<script>
    $(document).ready(function () {
        $.ajax({
            type: 'GET',
            dataType: "json",
            headers: {
                'Authorization': 'Bearer ' + sessionStorage.getItem("token").toString(),
            },
            contentType: "application/json",
            url: '/api/Carparks/',
            success: function (result) {
                google.charts.load('current', {
                    'packages': ['corechart']
                });
                google.charts.setOnLoadCallback(function () {
                    drawChart(result);
                });
            }
        });

        function drawChart(result) {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'CarparkName');
            data.addColumn('number', 'LotsAvailable');
            var dataArray = [];
            $.each(result, function (i, obj) {
                dataArray.push([obj.carparkName, obj.totalNumberOfLotsAvailable]);
            });

            data.addRows(dataArray);
            var piechart_options = {
                title: 'Pie Chart: Amount of Lots Available',
                width: 400,
                height: 300
            };
            var piechart = new google.visualization.PieChart(document.getElementById('piechart_div'));
            piechart.draw(data, piechart_options);

            var barchart_options = {
                title: 'Barchart: Amount of Lots Available',
                width: 400,
                height: 300,
                legend: 'none'
            };
            var barchart = new google.visualization.BarChart(document.getElementById('barchart_div'));
            barchart.draw(data, barchart_options);
        }

    });
</script>

<div class="row">
    <div class="col-md-6">
        <div id="piechart_div" style="border:1px solid #ccc"></div>
    </div>
    <div class="col-md-6">
        <div id="barchart_div" style="border:1px solid #ccc"></div>
    </div>
</div>
<meta name="viewport" content="initial-scale=1.0, width=device-width" />
<link rel="stylesheet" type="text/css" href="https://js.api.here.com/v3/3.0/mapsjs-ui.css?dp-version=1542186754" />
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-core.js"></script>
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-service.js"></script>
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-ui.js"></script>
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-mapevents.js"></script>

<div style="width: 640px; height: 480px" id="mapContainer"></div>
<div id="map" style="width: 100%; height: 400px; background: grey" />
<script type="text/javascript" charset="UTF-8">

function moveMapToBerlin(map){
    map.setCenter({ lat: 1.3521, lng: 103.8198});
  map.setZoom(12);
}





/**
 * Boilerplate map initialization code starts below:
 */

//Step 1: initialize communication with the platform
var platform = new H.service.Platform({
  app_id: 'devportal-demo-20180625',
  app_code: '9v2BkviRwi9Ot26kp2IysQ',
  useHTTPS: true
});
var pixelRatio = window.devicePixelRatio || 1;
var defaultLayers = platform.createDefaultLayers({
  tileSize: pixelRatio === 1 ? 256 : 512,
  ppi: pixelRatio === 1 ? undefined : 320
});

//Step 2: initialize a map  - not specificing a location will give a whole world view.
var map = new H.Map(document.getElementById('map'),
  defaultLayers.normal.map, {pixelRatio: pixelRatio});

//Step 3: make the map interactive
// MapEvents enables the event system
// Behavior implements default interactions for pan/zoom (also on mobile touch environments)
var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

// Create the default UI components
var ui = H.ui.UI.createDefault(map, defaultLayers);

// Now use the map as required...
moveMapToBerlin(map);
</script>